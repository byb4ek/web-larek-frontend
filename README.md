# Проектная работа "Веб-ларек"

Стек: `HTML`, `SCSS`, `TS`, `Webpack`

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
export interface IProductItem {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  price: number | null;
}
```

Интерфейс описывает данные частей приложения: каталог, превью, корзина, форма заказа,

```
export interface IAppState {
  catalog: IProductItem[];
  preview: string;
  basket: string[];
  order: IOrder;
  total: string | number;
  loading: boolean;
}
```

Список продуктов

```
export interface IProductsList {
  products: IProductItem[];
}
```

Данные формы заказа

```
export interface IOrderForm {
  payment?: string;
  address?: string;
  phone?: string;
  email?: string;
  total?: string | number;
}
```

Данные покупки

```
export interface IOrder extends IOrderForm {
  items: string[];
}
```

Интерфейс успешного заказа

```
export interface IOrderResult {
  id: string;
}
```

Тип ошибки заказа

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Хранит основные поля и методы, необходимые при работе с сервером.\
В конструктор передается базовый url (baseUrl) и опции запроса (options).

Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс Model

Абстрактный класс дженерик, обощающий в себе конструктор и метод привязки события.

Конструктор:

- принимает на вход объект данных неявного типа и объект события типа IEvent.
- производит слияние входящего объекта с родительским

Методы:

- `emmitChanges` — регистрирует входящее событие в EventEmitter

#### Component

Абстрактный класс дженерик, обобщающий в себе конструктор и основные методы работы с компонентами отображения.

Конструктор:
-принимает на вход `container` типа HTMLElement

Методы:

- `toggleClass` - метод переключения классов
- `setText` - метод установки текстового содержимого
- `setDisabled` - метод сменить статус блокировки
- `setHidden` - метод скрытия
- `setVisible` - метод показать
- `setImage` - метод установить изображения с алтернативным текстом
- `render` - метод возвращения корневого DOM-элемента

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductItem

Принимает и хранит в себе данные об одном продукте: идентифекатор, заголовок, описание, категория, изображение, цену.

Поля класса:

- `id` - идентифекатор продукта
- `title` - название продукта
- `description` - описание продукта
- `category` - категория рассматриваемого продукта
- `image` - изображение описывающее продукт
- `price` - цена продукта

Расширяем базовым классом Model, копируя свойства объекта в текущий экземпляр класса и методом для уведомления об изменениях в модели.
И используем для работы с методами и данными в следующем классе AppDate.

#### Класс AppData

Содержит в себе основные данные и методы для работы с моделью данных в целом. Выступает как собирающий класс.

Поля класса:

- `catalog` - для данных списка товаров
- `preview` - для данных выбранного товара (попап)
- `bascket` - для данных корзины покупок
- `order` - для данных заказа, который отправляется на сервер

Методы:

- `setCatalog` - установить данные в каталог (вывести все наши продукты на страницу)
- `setPreview` - установить данные в первью
- `setProductToBasket` - установить данные в продукты корзины
- `setTotal` - установить финальную сумму заказа
- `setOrderAddress` - установить даныне окна адреса и способа оплаты
- `setOrderContacts` - установить данные окна телефона и почты
- `get Total` - получить финальную сумму заказа
- `get Basket` - получить данные из корзины
- `get StatusBasket` - получить статус корзины
- `addProductToOrder` - добавить данные карточки в заказ
- `removeProductFromOrder` - убрать один продукт из заказа
- `clearBasket` - очистить данные корзины
- `validationOrderAddress` - провести валидацию данных адреса заказа
- `validationOrderContacts` - провести валидацию данных контактов заказа

#### Класс AppAPI

Основной класс работы с API. Расширяется базовым классом Api.

Конструктор принимает:

- принимает и передает в родительский конструктор `baseUrl` и `options`
- записывает в поле `api` текущий URL

Методы класса:

- `getProductList` - метод запроса списка товаров с сервера
- `orderProducts` - метод отправки данных заказа на сервер

#### Классы представления (View)

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

### Page

Класс Page отвечает за отображение всех элементов страницы: корзины, счетчика корзины, каталога товаров.

Поля класса:

- `_counter` - отвечает за счетчик корзины
- `_catalog` - отвечает за хранение разметки каталога карточек
- `_buttonBasket` - отвечает за хранение разметки кнопки корзины
- `_wrapper` - отвечает за хранение обертки страницы

Методы класса:

- `set counter` - отвечает за установку счетчика
- `set catalog` - отвечает за установку каталога

### Card

Класс Card будет отвечать за отображение каждой карточки в отдельности, взятой из каталога.

Поля:

- `_title` - отвечает за храненине названия карточки
- `_category` - хранит разметку категории карточки
- `_image` - хранит разметку изображения карточки
- `_price` - хранит разметку цены карточки
- `_colorCategory` - хранит разметку рамки категории

Конструктор:

- принимает: container:HTMLElement и action:ICardAction
- передает container в родительский конструктор
- записывает данные в необходимые поля
- вешает слушатель клика

Методы:

- `set title` - устанавливает название товара
- `set category` - устанавливает данные категори товара
- `set image` - устанавливает даныне изображение
- `set price` - устанавливает данные цены карточки
- `set colorCategory` - устанавливает данные цвета категории

Класс расширяется Component<ICard>, а также в конструкторе используется интерфейс ICardAction

```
inteface ICard {
	title: string;
  category: string;
  image: string;
  price: number;
  text: string;
}
```

```
interface ICardAction{
	onClick(evt:MouseElement) => void;
}
```

### CardPreview

Класс отображает наше превью выбранной карточки. Расширяется классом Card, так как там есть основные данные карточки, с помощью интерфейса ICardDescription, проверяет наличие данного текста.

```
interface ICardDescription{
	description:string;
}
```

Поля:

- `_button` - хранит разметку кнопки "В корзину"
- `_description` - хранит разметку описания

Конструктор:

- принимает: container:HTMLElement и action:ICardAction
- записывает данные разметки в поля
- передает `container` и `action` в родительский конструктор

```
interface ICardAction{
	onClick(evt:MouseElement) => void;
}
```

Методы:

- `set description` - установка содержимого описания

### CardBasket

Данный класс отвечает за отображение данных карточки в корзине.

Расширяется классом, с типом ICardBasket (Component<ICardBasket>).

```
interface ICardBasket {
	_index:string,
	_title: string,
	_price:string,
}
```

Поля:

- `_index` - хранит разметку индекс карточки
- `_title` - хранит разметку название карточки
- `_price` - хранит разметку цену карточки
- `_button` - хранит разметку кнопки карточки

Конструктор:

- принимает container: HTMLElement и action:ICardAction
- передает в родительский конструктор container
- записывает данные разметки в поля класса

Методы:

- `get index` - установка данных индекса
- `get title` - установка данных названия
- `get price` - установка данных цены

### Modal

Принимает разметку модального окна, отвечает за отображение обертки содержимого таких элементов (модальных окон).
Расширяется Component<IModalData>.

```
interface IModalData{
	content:HTMLElement;
}
```

Поля:

- `_content` - отвечает за храненеие разметки контейнера модального окна
- `_buttonClose` - отвечает за хранение кнопки закрытия модального окна

Конструктор:

- принимает `сontainer` с типом HTMLElement и `evt` с типом IEvent
- передает данные в родительский конструктор
- записывает нужные данные в поля класса
- добаляет слушатель на `_buttonClose` и `container` для закртия модалки, вешает слушатель на `content`, чтобы модалка не закрылась

Методы:

- `set Content` - устанавливает содержимое корзины
- `open` - открывает модальное окно
- `close` - закрывает модально окно
- `render` - отрисовывает данные и открывает модалку

### Form

Класс отвечает за обертку форм с данными, работу с ними.
Расширяется классом Componets<IForm>.

```
interface IForm {
	errors:string[];
	valid:boolean;
}
```

Поля:

- `_errors` - хранит разметку поля ошибок в инпутах
- `_submit` - хранит разметку кнопки сабмита

Конструктор:
- принимает `container:HTMLElement`, `evt:IEvent`,
- сохраняет информацию разметки в поля класса,
- передает в родительский констрктор данные,
- добавляет слушатели на сабмит и инпуты

Методы:

- `render` - рендерит форму (отрисовывает)
- `inputChange` - фиксирует изменения в инпутах
- `set valid` - устанавливает валидность формы
- `set errors` - устанавливает ошибки

### Basket

Класс отвечает за отображение корзины: кнопки сабмита, полной стоимости.

Расширяется классом Componets<IBasket>.

```
interface IBasket{
	items:HTMLElement[];
	total:number;
}
```

Поля:

- `_total` - хранит разметку обертки полной стоимости
- `submitButton` - хранит разметку кнопки
- `_list` - хранит разметку листа карточек (товаров)
- `items` - хранит список товаров

Конструктор:

- принимает `container` типа HTMLElement и `event` типа IEvent
- записывает данные в поля
- передает данные в родительский класс (конструктор)
- вешает слушатель на кнопку сабмита

Методы:

- `set total` - устанавливает финальную сумму
- `set items` - устанавливает карточки в разметку `_list`

### OrderContacts

Отвечает за второе модальное окно оплаты заказа, расширяется классом Form<IOrderForm> (интерфейс описан выше).

Поля:

- `_buttons` - хранит разметку кнопки формы

Конструктор:

- принимает `container:HTMLElement` и объект `event:IEvent`
- передает данные в родительский конструктор

Методы:

- `set phone` - устанавливает значение инпута телефона
- `set email` - устанавливает значение инпута почты

### OrderAddress

Отвечает за первое модальное окно оплаты заказа, расширяется классом Form<IOrderForm> (интерфейс описан выше).

Поля:
- `_buttons` — хранит разметку кнопок формы оплаты

Конструктор:

- принимает `container:HTMLElement` и объект `event:IEvent`
- передает данные в родительский конструктор
- сохраняет необходимые элементы разметки в полях
- на кнопки выбора формы оплаты вешает слушатель click

Методы

- `set payment` — устанавливает класс активности на кнопку
- `set address` — устанавливает значение поля адрес

### Success

Класс нужен для отображения данных успешного заказа (оформления заказа)
Расширяется Component<ISuccess>.

```
interface ISuccess{
	total:string | number;
}
```

Поля:
- `_total` - разметка общей суммы товаров 
- `_close` - разметка кнопки закрытия окна

Конструктор:

- принимает `container:HTMLElement` и `actions:ISuccessActions`.
- сохраняет необходимые данные в поля класса
- вешает слушатель на кнопку `_close`
- передает данные в родительский конструктор

```
interface ISuccessActions{
	onClick: () => void;
}
```

Методы:
- `set total` - установка полной стоимости

### Взаимодействие компонентов (Presenter)

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в index.ts\
В index.ts сначала создаются экземпляры событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts\

Список всех событий, генерируемых в системе:
События изменения данных (генерируются классами моделями данных)

- `product:selected` - изменение открываемого в модальном окне товара
- `products:changed` - изменение массива товаров
- `items:changed` - изменение массива товаров в корзине

События, возникающие при взаимодействии пользователя с интерфейсом:

- `basket:submit` - подтверждение товаров в корзине
- `basket:open` - открытие корзины
- `modal:changed` - изменение контента модального окна
- `product:select` - выбор товара для просмотра в модальном окне
- `product:previewClear` - необходима очиста данных выбранного для показа в модальном окне товара
- `item:select` - выбор карточки для добавления в корзину
- `item:delete` - выбор товара для удаления из корзины
- `order:input` - изменение данных в форме с информацией заказа
- `contacts:input` - изменение данных в форме с контактами пользователя
- `order:submit` - сохранение данных о заказе в форме
- `contacts:submit` - сохранение данных о контактах пользователя в форме
- `order:validated` - событие после выполнения валидации формы заказа
- `contacts:validated` - событие после выполнения валидации формы контактов пользователя
- `order:completed` - завершение оформления заказа
- `contacts:completed` - завершение оформления заказа (контакты)
